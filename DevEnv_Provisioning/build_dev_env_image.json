{
  "variables": {
    "aws_access_key": "",
    "aws_secret_key": "",
    "region": "",
    "resource_tag_name": "",
    "resource_tag_value": "",
    "git_username": "vinhphu3000",
    "git_password": "",
    "git_repo": "github.com/vinhphu3000/aws-provisioning.git",
    "git_version": "master",
    "git_root_folder": "./"
  },
  "builders": [{
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "{{user `region`}}",
    "source_ami_filter": {
      "filters": {
        "virtualization-type": "hvm",
        "name": "amzn-ami-hvm*x86_64-gp2",
        "root-device-type": "ebs"
      },
      "owners": ["137112412989"],
      "most_recent": true
    },
    "instance_type": "m3.medium",
    "ssh_username": "ec2-user",
    "ami_name": "pha-dev-env{{timestamp}}",
    "ami_description": "",
    "ebs_optimized": false,
    "force_deregister": true,
    "force_delete_snapshot": true,
    "shutdown_behavior": "terminate",
    "tags": {
      "{{user `resource_tag_name`}}": "{{user `resource_tag_value`}}"
    }
  }],

  "provisioners": [{
    "type": "ansible",
    "playbook_file": "./roles/packer/tasks/main.yml",
    "user": "ec2-user",
    "extra_arguments": [
        "FOLDER_STRUCTURE_GIT_DEST={{user `git_root_folder`}}",
        "FOLDER_STRUCTURE_GIT_USERNAME={{user `git_username`}}",
        "FOLDER_STRUCTURE_GIT_PASSWORD={{user `git_password`}}",
        "FOLDER_STRUCTURE_GIT_REPO={{user `git_repo`}}",
        "FOLDER_STRUCTURE_GIT_VERSION={{user `git_version`}}"
    ]
  }]
}
